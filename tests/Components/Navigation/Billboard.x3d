<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE X3D PUBLIC "ISO//Web3D//DTD X3D 3.3//EN" "http://www.web3d.org/specifications/x3d-3.3.dtd">
<X3D profile='Full' version='3.3' xmlns:xsd='http://www.w3.org/2001/XMLSchema-instance' xsd:noNamespaceSchemaLocation='http://www.web3d.org/specifications/x3d-3.3.xsd'>
  <head>
    <meta name='comment' content='World of Titania'/>
    <meta name='created' content='Fri, 18 Sep 2015 01:10:27 GMT'/>
    <meta name='creator' content='Holger Seelig'/>
    <meta name='generator' content='Titania V1.2.2, http://titania.create3000.de'/>
    <meta name='modified' content='Sat, 02 Jan 2016 06:07:53 GMT'/>
    <meta name='title' content='Billboard 1 1 1'/>
  </head>
  <Scene>
    <WorldInfo
        title='Billboard'>
      <MetadataSet DEF='Titania'
          name='Titania'
          reference='http://titania.create3000.de'>
        <MetadataSet DEF='NavigationInfo' containerField='value'
            name='NavigationInfo'
            reference='http://titania.create3000.de'>
          <MetadataString DEF='type' containerField='value'
              name='type'
              reference='http://titania.create3000.de'
              value='"EXAMINE"'/>
        </MetadataSet>
        <MetadataSet DEF='Viewpoint' containerField='value'
            name='Viewpoint'
            reference='http://titania.create3000.de'>
          <MetadataDouble DEF='position' containerField='value'
              name='position'
              reference='http://titania.create3000.de'
              value='0, 0, 10'/>
          <MetadataDouble DEF='orientation' containerField='value'
              name='orientation'
              reference='http://titania.create3000.de'
              value='0, 0, 1, 0'/>
          <MetadataDouble DEF='centerOfRotation' containerField='value'
              name='centerOfRotation'
              reference='http://titania.create3000.de'
              value='0, 0, 0'/>
        </MetadataSet>
      </MetadataSet>
    </WorldInfo>
    <Background
        skyAngle='0.8, 1.3, 1.4, 1.5708'
        skyColor='0.21 0.31 0.59, 0.33 0.45 0.7, 0.57 0.66 0.85, 0.6 0.73 0.89, 0.7 0.83 0.98'
        groundAngle='0.6, 1.2, 1.3, 1.5708'
        groundColor='0.21 0.31 0.59, 0.33 0.45 0.7, 0.57 0.66 0.85, 0.6 0.73 0.89, 0.7 0.83 0.98'/>
    <Viewpoint
        description='Front'/>
    <Viewpoint
        description='z pi/2'
        orientation='0 0 1 1.5708'/>
    <Viewpoint
        description='y pi/2'
        position='10 0 0'
        orientation='0 1 0 1.5708'/>
    <ProximitySensor DEF='Proxy'
        size='1000 1000 1000'/>
    <Transform DEF='HUD'
        translation='-0 0 10'>
      <Transform
          translation='0 -0.3 -1'
          scale='0.02 0.02 0.02'>
        <Transform>
          <TouchSensor DEF='TouchX'
              description='1 0 0'/>
          <Transform>
            <Shape>
              <Appearance>
                <Material DEF='Rococo12'
                    ambientIntensity='0.226102'
                    diffuseColor='0.904409 0.146366 0.208768'
                    specularColor='0.0955906 0.0955906 0.0955906'
                    shininess='0.078125'/>
              </Appearance>
              <Box/>
            </Shape>
          </Transform>
        </Transform>
        <Transform
            translation='3 0 0'>
          <TouchSensor DEF='TouchY'
              description='0 1 0'/>
          <Transform>
            <Shape>
              <Appearance>
                <Material DEF='Rococo28'
                    ambientIntensity='0.226102'
                    diffuseColor='0.279645 0.904409 0.511589'
                    specularColor='0.0955906 0.0955906 0.0955906'
                    shininess='0.078125'/>
              </Appearance>
              <Box/>
            </Shape>
          </Transform>
        </Transform>
        <Transform
            translation='6 0 0'>
          <TouchSensor DEF='TouchXYZ'
              description='1 1 1'/>
          <Transform>
            <Shape>
              <Appearance>
                <Material DEF='Rococo24'
                    ambientIntensity='0.226102'
                    diffuseColor='0.28636 0.554905 0.904409'
                    specularColor='0.0955906 0.0955906 0.0955906'
                    shininess='0.078125'/>
              </Appearance>
              <Box/>
            </Shape>
          </Transform>
        </Transform>
        <Transform
            translation='9 0 0'>
          <TouchSensor DEF='TouchZ'
              description='0 0 1'/>
          <Transform>
            <Shape>
              <Appearance>
                <Material DEF='Rococo1'
                    ambientIntensity='0.187004'
                    diffuseColor='0.636212 0.748016 0.300948'
                    specularColor='0.412121 0.412121 0.412121'
                    shininess='0.8'/>
              </Appearance>
              <Box/>
            </Shape>
          </Transform>
        </Transform>
        <Transform
            translation='12 0 -5.68434e-14'>
          <TouchSensor DEF='TouchZ_1'
              description='0 0 0'/>
          <Transform>
            <Shape>
              <Appearance>
                <Material DEF='Rococo35'
                    ambientIntensity='0.0499912'
                    diffuseColor='0.195355 0.197924 0.199965'
                    specularColor='0.430303 0.430303 0.430303'
                    shininess='0.406061'/>
              </Appearance>
              <Box/>
            </Shape>
          </Transform>
        </Transform>
      </Transform>
    </Transform>
    <Transform>
      <Billboard DEF='Billboard'
          axisOfRotation='1 1 1'>
        <Transform DEF='XForm'>
          <Transform
              rotation='1 0 0 1.5708'>
            <Shape>
              <Appearance>
                <Material/>
              </Appearance>
              <Cone/>
            </Shape>
          </Transform>
          <Shape>
            <Appearance>
              <Material/>
            </Appearance>
            <IndexedLineSet
                colorIndex='0, 1, -1, 2, 3, -1'
                coordIndex='0, 1, -1, 2, 3, -1'>
              <Color
                  color='0 0 0, 1 1 1, 0 0 0, 1 1 1'/>
              <Coordinate DEF='Local'
                  point='-2 0 0, 2 0 0, 0 -2 0, 0 2 0'/>
            </IndexedLineSet>
          </Shape>
          <Transform
              translation='2 0 0'
              scale='0.5 0.5 0.5'>
            <Billboard
                axisOfRotation='0 0 0'>
              <Shape>
                <Appearance>
                  <Material
                      diffuseColor='0 0 0'/>
                </Appearance>
                <Text
                    string='"x"'/>
              </Shape>
            </Billboard>
          </Transform>
          <Transform
              translation='0 2 0'
              scale='0.5 0.5 0.5'>
            <Billboard
                axisOfRotation='0 0 0'>
              <Shape>
                <Appearance>
                  <Material
                      diffuseColor='0 0 0'/>
                </Appearance>
                <Text
                    string='"y"'/>
              </Shape>
            </Billboard>
          </Transform>
        </Transform>
        <Shape DEF='LocalAxisOfRotation1'>
          <Appearance>
            <LineProperties
                linetype='3'/>
            <Material/>
          </Appearance>
          <IndexedLineSet
              coordIndex='0, 1, -1'>
            <Coordinate DEF='LocalAxisOfRotation'
                point='-3 -3 -3, 3 3 3'/>
          </IndexedLineSet>
        </Shape>
      </Billboard>
    </Transform>
    <Transform>
      <SphereSensor DEF='AxisSensor'
          offset='-0.707107 0.707107 0 0.955317'/>
      <Transform DEF='AxisOfRotation'
          rotation='-0.707107 0.707107 0 0.955317'>
        <Transform
            translation='0 0 2'
            rotation='1 0 0 1.5708'
            scale='0.1 0.1 0.1'>
          <Shape>
            <Appearance>
              <Material
                  diffuseColor='0 1 0'/>
            </Appearance>
            <Cone/>
          </Shape>
        </Transform>
        <Transform
            translation='0 0 -2'
            scale='0.1 0.1 0.1'>
          <Shape>
            <Appearance>
              <Material
                  diffuseColor='1 0 0'/>
            </Appearance>
            <Sphere/>
          </Shape>
        </Transform>
        <Shape>
          <Appearance>
            <Material/>
          </Appearance>
          <IndexedLineSet
              colorPerVertex='false'
              colorIndex='0, 1'
              coordIndex='0, 1, -1, 1, 2, -1'>
            <Color
                color='1 0 0, 0 1 0'/>
            <Coordinate
                point='0 0 -2, 0 0 0, 0 0 2'/>
          </IndexedLineSet>
        </Shape>
      </Transform>
    </Transform>
    <Transform DEF='ZAxis'>
      <Shape>
        <Appearance>
          <Material/>
        </Appearance>
        <IndexedLineSet
            colorPerVertex='false'
            colorIndex='0, 1'
            coordIndex='0, 1, -1, 1, 2, -1'>
          <Color
              color='0 0 0, 0 0 1'/>
          <Coordinate
              point='0 0 -2, 0 0 0, 0 0 2'/>
        </IndexedLineSet>
      </Shape>
      <Transform
          translation='0 0 2'
          scale='0.5 0.5 0.5'>
        <Billboard
            axisOfRotation='0 0 0'>
          <Shape>
            <Appearance>
              <Material
                  diffuseColor='0 0 0'/>
            </Appearance>
            <Text
                string='" z"'/>
          </Shape>
        </Billboard>
      </Transform>
      <Transform
          translation='0 0 2'
          rotation='1 0 0 1.5708'
          scale='0.1 0.1 0.1'>
        <Shape>
          <Appearance>
            <Material
                diffuseColor='0 0 1'/>
          </Appearance>
          <Cone/>
        </Shape>
      </Transform>
    </Transform>
    <Transform DEF='Normal'
        rotation='0.707107 0.707107 -0 1.5708'>
      <Shape>
        <Appearance>
          <Material/>
        </Appearance>
        <IndexedLineSet
            colorPerVertex='false'
            colorIndex='0, 1'
            coordIndex='0, 1, -1'>
          <Color
              color='1 1 0, 1 1 0'/>
          <Coordinate
              point='0 0 0, 0 0 2'/>
        </IndexedLineSet>
      </Shape>
      <Transform
          translation='0 0 2'
          rotation='1 0 0 1.5708'
          scale='0.1 0.1 0.1'>
        <Shape>
          <Appearance>
            <Material
                diffuseColor='1 1 0'/>
          </Appearance>
          <Cone/>
        </Shape>
      </Transform>
      <Transform
          translation='0 0 2'
          scale='0.3 0.3 0.3'>
        <Billboard
            axisOfRotation='0 0 0'>
          <Shape>
            <Appearance>
              <Material
                  diffuseColor='0 0 0'/>
            </Appearance>
            <Text
                string='" normal"'/>
          </Shape>
        </Billboard>
      </Transform>
    </Transform>
    <Transform DEF='Rotation'
        rotation='-0.357407 -0.862856 -0.357407 1.71777'>
      <Shape>
        <Appearance>
          <Material
              emissiveColor='1 0 0'/>
        </Appearance>
        <Arc2D DEF='Arc'
            endAngle='0.955317'/>
      </Shape>
    </Transform>
    <Script DEF='AxisScript'
        directOutput='true'>
      <field accessType='inputOnly' type='SFTime' name='set_x'/>
      <field accessType='inputOnly' type='SFTime' name='set_y'/>
      <field accessType='inputOnly' type='SFTime' name='set_z'/>
      <field accessType='inputOnly' type='SFTime' name='set_xyz'/>
      <field accessType='inputOnly' type='SFTime' name='set_0'/>
      <field accessType='inputOnly' type='SFRotation' name='set_rotation'/>
      <field accessType='inputOnly' type='SFVec3f' name='set_position'/>
      <field accessType='initializeOnly' type='SFNode' name='billboard'>
        <Billboard USE='Billboard'/>
      </field>
      <field accessType='initializeOnly' type='SFNode' name='xform'>
        <Transform USE='XForm'/>
      </field>
      <field accessType='initializeOnly' type='SFNode' name='absolute'>
        <Transform USE='AxisOfRotation'/>
      </field>
      <field accessType='initializeOnly' type='SFNode' name='local'>
        <Coordinate USE='LocalAxisOfRotation'/>
      </field>
      <field accessType='initializeOnly' type='SFNode' name='sensor'>
        <SphereSensor USE='AxisSensor'/>
      </field>
      <field accessType='initializeOnly' type='SFNode' name='normal'>
        <Transform USE='Normal'/>
      </field>
      <field accessType='initializeOnly' type='SFNode' name='rotation'>
        <Transform USE='Rotation'/>
      </field>
      <field accessType='initializeOnly' type='SFNode' name='arc'>
        <Arc2D USE='Arc'/>
      </field>
      <field accessType='initializeOnly' type='SFNode' name='proxy'>
        <ProximitySensor USE='Proxy'/>
      </field>
<![CDATA[vrmlscript:
function initialize ()
{
	set_xyz ();
}

function set_x ()
{
	set_axisOfRotation (new SFVec3f (1, 0, 0));
}

function set_y ()
{
	set_axisOfRotation (new SFVec3f (0, 1, 0));
}

function set_z ()
{
	set_axisOfRotation (new SFVec3f (0, 0, 1) .normalize () .multiply (2));
}

function set_xyz ()
{
	set_axisOfRotation (new SFVec3f (1, 1, 1));
}

function set_0 ()
{
	set_axisOfRotation (new SFVec3f ());
}

function set_rotation (value)
{
	set_axisOfRotation (value .multVec (new SFVec3f (0, 0, 1)));
}

function set_position ()
{
	set_axisOfRotation (billboard .axisOfRotation);
}

var xAxis = new SFVec3f (1, 0, 0);
var zAxis = new SFVec3f (0, 0, 1);

function set_axisOfRotation (axisOfRotation)
{
	billboard .axisOfRotation = axisOfRotation;
	
	// Normal of plane between axisOfRotation and billbordToViewer

	var vector = axisOfRotation .cross (proxy .position_changed);
	normal .rotation = new SFRotation (zAxis, vector);

	// axisOfRotation

	var axisRotation = new SFRotation (zAxis, axisOfRotation);
	
	local .point       = new MFVec3f (axisOfRotation .multiply (3) .negate (), axisOfRotation .multiply (3));
	absolute .rotation = axisRotation;
	sensor .offset     = axisRotation;

	// Angle between zAxis and axisOfRotation
	var angle = Math .acos (zAxis .dot (axisOfRotation .normalize ()));
	var rot   = new SFRotation (zAxis, zAxis .cross (axisOfRotation));
	rotation .rotation = rot .multiply (new SFRotation (rot .multVec (xAxis), zAxis));

	arc .endAngle = angle;

	print ('axisOfRotation: ', local .point);
	print ('axisOfRotation: ', axisOfRotation);
	print ('normal:         ', vector);
	print ('angle:          ', angle);
	

	var n = vector .normalize ();
	var a = axisOfRotation .cross (zAxis .cross (axisOfRotation)) .normalize ();
			
	var angle = n .dot (a);
	print ('angle n         ', angle);

}
]]> 
    </Script>
    <ROUTE fromNode='Proxy' fromField='position_changed' toNode='HUD' toField='set_translation'/>
    <ROUTE fromNode='Proxy' fromField='orientation_changed' toNode='HUD' toField='set_rotation'/>
    <ROUTE fromNode='Proxy' fromField='position_changed' toNode='AxisScript' toField='set_position'/>
    <ROUTE fromNode='TouchX' fromField='touchTime' toNode='AxisScript' toField='set_x'/>
    <ROUTE fromNode='TouchY' fromField='touchTime' toNode='AxisScript' toField='set_y'/>
    <ROUTE fromNode='TouchZ' fromField='touchTime' toNode='AxisScript' toField='set_z'/>
    <ROUTE fromNode='TouchXYZ' fromField='touchTime' toNode='AxisScript' toField='set_xyz'/>
    <ROUTE fromNode='AxisSensor' fromField='rotation_changed' toNode='AxisScript' toField='set_rotation'/>
    <ROUTE fromNode='TouchZ_1' fromField='touchTime' toNode='AxisScript' toField='set_0'/>
  </Scene>
</X3D>
